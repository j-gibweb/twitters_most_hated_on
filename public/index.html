<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
 
 <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js" type="text/javascript"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>


 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/css/bootstrap.min.css">

</head>
<body>

  <div class="container">
    <h1>List of Things To Do</h1>
    <hr />

    <form>
      <input name="name" placeholder="Name" value="Appointment"> <br />
      <input name="description" placeholder="Description" value="Go get food to eat, so hungry">
      <br /><br />
      <input type="submit" class="btn btn-success"  value="Submit">
      
    </form>

    <div class="page">
      <ul class="list">     
      
      </ul>
    </div>
  </div>

  <!-- <form>
    <input name="name" placeholder="Name" value="Purple"> <br />
    <input name="description" placeholder="Description" value="It's a purple block.">
    <input type="submit" value="Submit">
  </form> -->

  <script type="text/template" id="todo-list-template">
    <table class="table striped">
      <thead>
        <tr>
          <th>Name</th><th>Description</th><th>Status</th><th></th>
        </tr>
      </thead>
      <tbody>
        <% _.each(todos, function(todo) { %>
          <tr>
            <td><%= htmlEncode(todo.get('name')) %></td>
            <td><%= htmlEncode(todo.get('description')) %></td>
            <td><%= htmlEncode(todo.get('completed')) %></td>
            <td>
              <a class="btn" href="#/edit/<%= todo.get('_id') %>">Edit</a>
              <a class="btn" href="#/delete/<%= todo.get('_id') %>" class="btn btn-danger delete">Delete</a>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </script>











  <script type="text/javascript">

    function htmlEncode(value){
      return $('<div/>').text(value).html();
    }

    $(document).ready(function(){
      // $('#update').on('click', function(event) {
      //   event.preventDefault();
        
      //   var test = new TodoItem({id: 1})
      //   test.fetch();
      //   test.set({name: "Changed"})
      //   // make a PUT request to urlRoot/id
      //   // todoItem.fetch()
      //   test.save({test: "check"})
      //   console.log( test.get('name') )
      // })

      // $('#create').on('click', function(event) {
      //   event.preventDefault();
        
      //   var testCreate = new TodoItem();
      //   testCreate.set({name: "Created a new Todo"})
      //   // make a PUT request to urlRoot/id
      //   // todoItem.fetch()
      //   testCreate.save();
      //   console.log( testCreate.get('id') );
      //   todoItem.trigger('customEvent');
      // })

      // var show = function() {
      //   var request = $.ajax('/blocks');
      //   request.done(function(obj) { 
      //     for (prop in obj) {
      //       var item = $('<li>' + '<a href="" class="delete" data-block="' + prop + '"> delete</a> ' + obj[prop] + '</li>')
      //       $('.list').append(item);
      //     }

      //     $('.delete').on('click', function(event) {
      //       event.preventDefault();
      //       var target = $(this);
            
      //       $.ajax({
      //         type: 'DELETE',
      //         url: '/blocks/' + target.data('block'),
      //       }).done(function() {
      //         target.parents('li').fadeOut();
      //       });

      //     });

      //   });
      // };

      // $('form').on('submit', function(event) {
      //   event.preventDefault();
      //   var form = $(this);
      //   var blockData = form.serialize();
      //   $.ajax({
      //     type: 'POST',
      //     url: '/blocks',
      //     data: blockData 
      //   }).done(function(value) {
      //     console.log(value);
      //     $('.list').append(value);
      //     form.trigger('reset');
      //   });
      // });
    });

      var Todos = Backbone.Collection.extend({
        url: '/todo'
      });

      // instantiate model
      var TodoItem = Backbone.Model.extend({
        urlRoot: '/todo',
        defaults: function() {
          // return this object every time, so that
          // new Date() re-evals each time a new shit is made
         return {
             name: "Default Name", 
             description: "Default description.",
             status: "incomplete"
           } 
        }
      });

      // instance of model
      var todoItem = new TodoItem({
        name: "Dirty Garbage", 
        description: "YUUUCK.",
        status: "incomplete"
      });

      todoItem.on('customEvent', function(event) {
        console.log('custom event taking place')
      });

      // getting attrs
      // todoItem.get('name')

      // setting attrs
      // todoItem.set({shit: "poop"});

      var TodoListView = Backbone.View.extend({
        el: '.page',
        render: function () {
          var that = this;
          var todos = new Todos();
          todos.fetch({
            success: function (todos) {
              console.log(todos.models)
              var template = _.template($('#todo-list-template').html(), {todos: todos.models});
              that.$el.html(template);
            }
          })
        }
      });

      var todoListView = new TodoListView();
      // todoListView.render();


      // View class
      var TodoView = Backbone.View.extend({
        tagName: 'li',
        className: 'todo',
        template: _.template("<h3><p><%= description %><p></h3>"),
        render: function() {
          // var html = "<h3>" + this.model.get('description') + "</h3>"
          var attributes = this.model.toJSON();
          $(this.el).html(this.template(attributes));
        },
        events: {
        // <event> <contained element> : <functionName>
        // equivilent to $(this.el).delegate('p', 'click', alertName)
          "click p": "alertName"
        },
        alertName: function(e) {
          console.log('clicked the todo item')
        }
      });
      
        
      

      var Router = Backbone.Router.extend({
          routes: {
            "": "home"
            // "edit/:id": "edit",
            // "delete/:id": "delete",
            // "new": "edit",
          }
      });

      var router = new Router;

      router.on('route:home', function() {
        // render user list
        todoListView.render();
      })

  Backbone.history.start();
  </script>

</body>

